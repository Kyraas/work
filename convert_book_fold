import os
import win32com.client
from PyPDF2 import PdfReader, PdfMerger


def convert_to_pdf(input_path, output_path):
    # Создаем объект Word
    word = win32com.client.Dispatch('Word.Application')

    # Открываем документ
    doc = word.Documents.Open(input_path)
    # doc.PageSetup.BookFoldPrinting = True

    # Изменяем настройки печати
    doc.PrintOut(False, False, 0, output_path, "Microsoft Print to PDF")

    # Закрываем документ и выходим из Word
    doc.Close()
    word.Quit()


def merge_pdfs(input_dir, output_path):
    # Создаем объект PdfFileMerger
    merger = PdfMerger()

    # Сканируем директорию и добавляем все PDF файлы в объект merger
    for filename in os.listdir(input_dir):
        if filename.endswith('.pdf'):
            filepath = os.path.join(input_dir, filename)
            pdf = PdfReader(filepath, 'rb')
            merger.append(pdf)

    # Сохраняем объединенный PDF файл
    merger.write(output_path)
    merger.close()

# Путь к директории с входными файлами
input_dir = r'C:\Users\ddas\Documents\Virtual env\PrintMany\ПЕЧАТЬ'

# Путь к выходному файлу
output_file = r'C:\Users\ddas\Documents\Virtual env\PrintMany\output.pdf'

# Конвертируем каждый входной файл в PDF и сохраняем в выходную директорию
for filename in os.listdir(input_dir):
    if "~" not in filename and (filename.endswith('.doc') or filename.endswith('.docx')):
        input_path = os.path.join(input_dir, filename)
        output_path = os.path.join(input_dir, f'{os.path.splitext(filename)[0]}.pdf')
        convert_to_pdf(input_path, output_path)

# Объединяем все PDF файлы в один большой файл
merge_pdfs(input_dir, output_file)
